{% extends "admin/base.html" %}
{% load i18n admin_urls static admin_list %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-list{% endblock %}

{% block content_title %}{% endblock %}
{% block content_subtitle %}{% endblock %}
{% block object-tools %}{% endblock %}

{% if not is_popup %}
{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; {{ opts.verbose_name_plural|capfirst }}
</div>
{% endblock %}
{% endif %}

{% block content %}
<div class="change-list-wrapper">
    <!-- Deprecation Warning (if applicable) -->
    {% if deprecation_warning %}
        {{ deprecation_warning|safe }}
    {% endif %}

    <!-- Header Section -->
    <div class="obc-admin-card mb-6">
        <div class="obc-admin-card__header">
            <div class="obc-space-between w-full">
                <div>
                    <div class="obc-admin-card__title">
                        <span class="obc-admin-card__icon">
                            {% if opts.app_label == 'common' %}
                                <i class="fas fa-cog"></i>
                            {% elif opts.app_label == 'communities' %}
                                <i class="fas fa-users"></i>
                            {% elif opts.app_label == 'mana' %}
                                <i class="fas fa-map"></i>
                            {% elif opts.app_label == 'coordination' %}
                                <i class="fas fa-handshake"></i>
                            {% elif opts.app_label == 'policy_tracking' %}
                                <i class="fas fa-lightbulb"></i>
                            {% elif opts.app_label == 'documents' %}
                                <i class="fas fa-file-alt"></i>
                            {% else %}
                                <i class="fas fa-table"></i>
                            {% endif %}
                        </span>
                        <span>{{ opts.verbose_name_plural|capfirst }}</span>
                    </div>
                    <p class="mt-2 text-sm text-slate-500">{% trans "Manage" %} {{ opts.verbose_name_plural|lower }}</p>

                    {% if cl.result_count %}
                        <div class="mt-4 flex flex-wrap items-center gap-3">
                            <span class="obc-admin-card__title-badge">
                                <i class="fas fa-list"></i>
                                {% if cl.result_count == 1 %}
                                    {{ cl.result_count }} {{ opts.verbose_name }}
                                {% else %}
                                    {{ cl.result_count }} {{ opts.verbose_name_plural }}
                                {% endif %}
                            </span>
                            {% if is_paginated %}
                                <span class="obc-metric-chip">
                                    {% trans "Page" %} {{ cl.page_num }} / {{ cl.paginator.num_pages }}
                                </span>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>

                <div class="flex flex-wrap items-center gap-3">
                    {% if has_add_permission %}
                        <a href="{% url cl.opts|admin_urlname:'add' %}{% if is_popup %}?{{ request.GET.urlencode }}{% endif %}" class="obc-admin-button obc-admin-button--primary text-sm">
                            <i class="fas fa-plus"></i>
                            {% blocktrans with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}
                        </a>
                    {% endif %}

                    {% if cl.has_filters %}
                        <button id="toggle-filters" type="button" class="obc-admin-button obc-admin-button--secondary text-sm" aria-controls="changelist-filter" aria-expanded="true">
                            <i class="fas fa-filter"></i>
                            {% trans "Filters" %}
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Actions -->
    {% if cl.search_fields %}
    <div class="obc-admin-card mb-6">
        <div class="obc-admin-card__body">
            <form method="get" class="obc-admin-actions w-full">
                <div class="obc-admin-search">
                    <i class="fas fa-search"></i>
                    <label for="searchbar" class="sr-only">{% trans 'Search' %}</label>
                    <input type="text" name="{{ search_var }}" value="{{ cl.query }}" id="searchbar" class="h-12 w-full rounded-xl border border-gray-200 bg-white px-4 text-sm text-slate-600 transition-all duration-200 focus:border-emerald-500 focus:outline-none focus:ring-4 focus:ring-emerald-500/40" placeholder="{% blocktrans %}Search {{ cl.opts.verbose_name_plural }}{% endblocktrans %}">
                </div>
                <div class="flex flex-wrap gap-3">
                    <button type="submit" class="obc-admin-button obc-admin-button--primary text-sm">
                        <i class="fas fa-search"></i>
                        {% trans 'Search' %}
                    </button>
                    {% if cl.query %}
                        <a href="?" class="obc-admin-button obc-admin-button--secondary text-sm">
                            <i class="fas fa-times"></i>
                            {% trans 'Clear' %}
                        </a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Filters Sidebar -->
    {% if cl.has_filters %}
    <div id="changelist-filter" class="obc-admin-card mb-6" hidden>
        <div class="obc-admin-card__header">
            <div class="obc-admin-card__title text-lg">
                <span class="obc-admin-card__icon text-base">
                    <i class="fas fa-filter"></i>
                </span>
                <span class="text-base font-semibold text-slate-700">{% trans 'Filter' %}</span>
            </div>
        </div>
        <div class="obc-admin-card__body">
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
                {% for spec in cl.filter_specs %}
                    <div class="space-y-2">
                        <h4 class="text-sm font-semibold text-slate-600 uppercase tracking-wide">{{ spec.title }}</h4>
                        <ul class="space-y-1">
                            {% for choice in spec.choices %}
                                <li>
                                    <a href="{{ choice.query_string|iriencode }}" class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-all duration-200 {% if choice.selected %}bg-emerald-50 text-emerald-700 font-semibold{% else %}text-slate-600 hover:bg-slate-100 hover:text-emerald-600{% endif %}">
                                        <i class="fas {% if choice.selected %}fa-check-circle{% else %}fa-circle{% endif %}"></i>
                                        <span class="flex-1">{{ choice.display }}</span>
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Actions -->
    {% if action_form and actions_on_top and cl.show_admin_actions %}
        <div class="obc-admin-card mb-6">
            <div class="obc-admin-card__body">
                <form method="post" class="obc-admin-actions w-full gap-4">
                    {% csrf_token %}
                    <div class="flex items-center gap-3 text-sm text-slate-600">
                        <label for="action-toggle" class="font-semibold text-slate-700">{% trans "Action:" %}</label>
                        <input type="checkbox" id="action-toggle" class="action-select-all h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                        <span class="text-xs uppercase tracking-wide text-slate-400">{% trans "Select all" %}</span>
                    </div>
                    <select name="action" required class="h-12 w-48 rounded-xl border border-gray-200 bg-white px-4 text-sm text-slate-600 shadow-sm transition-all duration-200 focus:border-emerald-500 focus:outline-none focus:ring-4 focus:ring-emerald-500/40">
                        <option value="" selected>---------</option>
                        {% for choice in action_form.action.field.choices %}
                            <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="obc-admin-button obc-admin-button--primary text-sm" name="index" value="{{ action_index|default:0 }}">
                        <i class="fas fa-play"></i>
                        {% trans "Go" %}
                    </button>
                </form>
            </div>
        </div>
    {% endif %}

    <!-- Results Table -->
    <div class="obc-admin-card overflow-hidden">
        <div class="obc-admin-card__body">
            {% if cl.formset.errors %}
                <div class="mb-4 flex items-start gap-3 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">
                    <i class="fas fa-circle-exclamation mt-1"></i>
                    <span>{% trans "Please correct the errors below." %}</span>
                </div>
            {% endif %}

            {% if cl.result_count %}
                <div class="results">
                    {% result_list cl %}
                </div>
            {% else %}
                <div class="flex flex-col items-center justify-center gap-4 py-12 text-center">
                    <span class="flex h-16 w-16 items-center justify-center rounded-full bg-slate-100 text-slate-400">
                        <i class="fas fa-inbox text-2xl"></i>
                    </span>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-700">
                            {% if cl.query %}
                                {% trans "No results found" %}
                            {% else %}
                                {% trans "No items yet" %}
                            {% endif %}
                        </h3>
                        <p class="mt-2 text-sm text-slate-500">
                            {% if cl.query %}
                                {% trans "Try adjusting your search or filter criteria." %}
                            {% else %}
                                {% blocktrans %}No {{ cl.opts.verbose_name_plural|lower }} have been created yet.{% endblocktrans %}
                            {% endif %}
                        </p>
                    </div>
                    {% if has_add_permission %}
                        <a href="{% url cl.opts|admin_urlname:'add' %}{% if is_popup %}?{{ request.GET.urlencode }}{% endif %}" class="obc-admin-button obc-admin-button--primary text-sm">
                            <i class="fas fa-plus"></i>
                            {% blocktrans with cl.opts.verbose_name as name %}Add the first {{ name }}{% endblocktrans %}
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Pagination -->
    {% if cl.result_count and is_paginated %}
        <div class="pagination-section mt-6">
            {% pagination cl %}
        </div>
    {% endif %}
</div>




{% endblock %}
